FROM ubuntu:trusty

RUN \
useradd -m -d /home/jenkins -s /bin/sh jenkins \
&& echo "jenkins:jenkins" | chpasswd

RUN \ 
apt-get -q update && apt-get install -y openssh-server software-properties-common git ant curl unzip xvfb dbus-x11 \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/* \
&& mkdir /var/run/sshd


RUN \
apt-get update \
&& apt-get --yes --force-yes install firefox \
&& apt-get --yes --force-yes install firefox=28.0+build2-0ubuntu2 \
&& apt-mark hold firefox \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/*

RUN \
mkdir -p /build/software/maven \
&& wget -P /build/software/maven https://archive.apache.org/dist/maven/maven-3/3.0.5/binaries/apache-maven-3.0.5-bin.tar.gz \
&& tar -xvzf /build/software/maven/apache-maven-3.0.5-bin.tar.gz --directory /build/software/maven \
&& rm /build/software/maven/apache-maven-3.0.5-bin.tar.gz

RUN \
wget -P /build/software/maven https://archive.apache.org/dist/maven/maven-3/3.2.2/binaries/apache-maven-3.2.2-bin.tar.gz \
&& tar -xvzf /build/software/maven/apache-maven-3.2.2-bin.tar.gz --directory /build/software/maven \
&& rm /build/software/maven/apache-maven-3.2.2-bin.tar.gz

RUN \
wget -P /build/software/maven https://archive.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz \
&& tar -xvzf /build/software/maven/apache-maven-3.3.9-bin.tar.gz --directory /build/software/maven \
&& rm /build/software/maven/apache-maven-3.3.9-bin.tar.gz

RUN \
wget -P /build/software/maven https://archive.apache.org/dist/maven/maven-2/2.2.1/binaries/apache-maven-2.2.1-bin.tar.gz \
&& tar -xvzf /build/software/maven/apache-maven-2.2.1-bin.tar.gz --directory /build/software/maven \
&& rm /build/software/maven/apache-maven-2.2.1-bin.tar.gz

RUN \
mkdir -p /build/software/java \
&& wget -P /build/software/java --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u45-b14/jdk-8u45-linux-x64.tar.gz \
&& tar -xvzf /build/software/java/jdk-8u45-linux-x64.tar.gz --directory /build/software/java \
&& rm /build/software/java/jdk-8u45-linux-x64.tar.gz \
&& mkdir -p /build/software/jce \
&& wget -P /build/software/jce --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jce/8/jce_policy-8.zip \
&& unzip -o /build/software/jce/jce_policy-8.zip -d /build/software/jce \
&& mv /build/software/java/jdk1.8.0_45/jre/lib/security/local_policy.jar /build/software/java/jdk1.8.0_45/jre/lib/security/local_policy-original.jar \
&& mv /build/software/java/jdk1.8.0_45/jre/lib/security/US_export_policy.jar /build/software/java/jdk1.8.0_45/jre/lib/security/US_export_policy-original.jar \
&& cp /build/software/jce/UnlimitedJCEPolicyJDK8/local_policy.jar /build/software/java/jdk1.8.0_45/jre/lib/security/ \
&& cp /build/software/jce/UnlimitedJCEPolicyJDK8/US_export_policy.jar /build/software/java/jdk1.8.0_45/jre/lib/security/ \
&& rm  /build/software/jce/jce_policy-8.zip \
&& rm -r /build/software/jce/UnlimitedJCEPolicyJDK8

RUN \
wget -P /build/software/java --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/7u51-b13/jdk-7u51-linux-x64.tar.gz \
&& tar -xvzf /build/software/java/jdk-7u51-linux-x64.tar.gz --directory /build/software/java \
&& rm /build/software/java/jdk-7u51-linux-x64.tar.gz \
&& wget -P /build/software/jce --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jce/7/UnlimitedJCEPolicyJDK7.zip \
&& unzip -o /build/software/jce/UnlimitedJCEPolicyJDK7.zip -d /build/software/jce \
&& mv /build/software/java/jdk1.7.0_51/jre/lib/security/local_policy.jar /build/software/java/jdk1.7.0_51/jre/lib/security/local_policy-original.jar \
&& mv /build/software/java/jdk1.7.0_51/jre/lib/security/US_export_policy.jar /build/software/java/jdk1.7.0_51/jre/lib/security/US_export_policy-original.jar \
&& cp /build/software/jce/UnlimitedJCEPolicy/local_policy.jar /build/software/java/jdk1.7.0_51/jre/lib/security/ \
&& cp /build/software/jce/UnlimitedJCEPolicy/US_export_policy.jar /build/software/java/jdk1.7.0_51/jre/lib/security/ \
&& rm /build/software/jce/UnlimitedJCEPolicyJDK7.zip \
&& rm -r /build/software/jce/UnlimitedJCEPolicy


RUN apt-get update && apt-get install -y openjdk-7-jdk && apt-get clean && rm -rf /var/lib/apt/lists/*

RUN \
add-apt-repository ppa:openjdk-r/ppa -y \
&& apt-get update && apt-get install -y openjdk-8-jdk \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/*

RUN \
wget -P /build/software/java --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/6u31-b04/jdk-6u31-linux-x64.bin \
&& chmod a+x /build/software/java/jdk-6u31-linux-x64.bin \
&& cd /build/software/java \
&& echo "\n" | sh /build/software/java/jdk-6u31-linux-x64.bin \
&& rm /build/software/java/jdk-6u31-linux-x64.bin

EXPOSE 22

CMD ["/usr/sbin/sshd", "-D"]
